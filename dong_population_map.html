<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „êµ­ í–‰ì •ë™ë³„ ì¸êµ¬ë³€í™” ì§€ë„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .dong-point {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .dong-point:hover {
            stroke-width: 3;
            filter: brightness(1.2);
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            max-width: 250px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .region-selector {
            max-height: 300px;
            overflow-y: auto;
        }
        .timeline-controls {
            background: linear-gradient(90deg, #3B82F6, #8B5CF6);
        }
        .population-legend {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-6">
        <!-- í—¤ë” -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ˜ï¸ ì „êµ­ í–‰ì •ë™ë³„ ì¸êµ¬ë³€í™” ì§€ë„</h1>
            <p class="text-gray-600">3,497ê°œ í–‰ì •ë™ Ã— 12ë…„ê°„(2014-2025) ì¸êµ¬ë³€í™” ì‹œê°í™”</p>
            <div class="mt-4 flex justify-center space-x-6 text-sm">
                <span class="bg-blue-100 px-3 py-1 rounded">ğŸ“ 3,497ê°œ í–‰ì •ë™</span>
                <span class="bg-green-100 px-3 py-1 rounded">ğŸ“… 12ë…„ ì‹œê³„ì—´</span>
                <span class="bg-purple-100 px-3 py-1 rounded">ğŸ¯ ì‹¤ì‹œê°„ ë¶„ì„</span>
            </div>
        </header>

        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="timeline-controls text-white rounded-lg shadow-md p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- ì‹œê°„ ì»¨íŠ¸ë¡¤ -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">â° ì‹œê°„ ë¶„ì„</h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3">
                            <label class="text-sm font-medium">ì—°ë„:</label>
                            <input type="range" id="yearSlider" min="2014" max="2025" value="2024" 
                                   class="flex-1" onchange="updateMapByYear(this.value)">
                            <span id="currentYear" class="text-lg font-bold">2024</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="playAnimation()" id="playBtn" class="px-4 py-2 bg-white bg-opacity-20 rounded hover:bg-opacity-30">
                                â–¶ï¸ ì¬ìƒ
                            </button>
                            <button onclick="resetMap()" class="px-4 py-2 bg-white bg-opacity-20 rounded hover:bg-opacity-30">
                                ğŸ”„ ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ì§€ì—­ ì„ íƒ -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">ğŸ—ºï¸ ì§€ì—­ ì„ íƒ</h3>
                    <div class="space-y-2">
                        <select id="regionSelector" onchange="selectRegion(this.value)" 
                                class="w-full px-3 py-2 text-gray-800 rounded">
                            <option value="">ì „êµ­ ë³´ê¸°</option>
                            <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                            <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                            <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                            <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                            <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                            <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                            <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                            <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                            <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                            <option value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
                            <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
                            <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                            <option value="ì „ë¶íŠ¹ë³„ìì¹˜ë„">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
                            <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                            <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                            <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
                            <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                        </select>
                        <div class="text-xs opacity-75">ì§€ì—­ ì„ íƒ ì‹œ í•´ë‹¹ ì§€ì—­ í™•ëŒ€</div>
                    </div>
                </div>

                <!-- ë¶„ì„ ëª¨ë“œ -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">ğŸ“Š ë¶„ì„ ëª¨ë“œ</h3>
                    <div class="space-y-2">
                        <select id="analysisMode" onchange="changeAnalysisMode(this.value)"
                                class="w-full px-3 py-2 text-gray-800 rounded">
                            <option value="population">ì¸êµ¬ ê·œëª¨</option>
                            <option value="change_rate">ì¸êµ¬ ì¦ê°ë¥ </option>
                            <option value="density">ì¸êµ¬ ë°€ë„</option>
                            <option value="aging">ê³ ë ¹í™”ìœ¨</option>
                            <option value="youth">ì²­ë…„ ë¹„ìœ¨</option>
                        </select>
                        <div class="text-xs opacity-75">ë¶„ì„ ê¸°ì¤€ ë³€ê²½</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í†µê³„ ëŒ€ì‹œë³´ë“œ -->
        <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold text-blue-600" id="totalDong">3,497</div>
                <div class="text-sm text-gray-600">ì´ í–‰ì •ë™</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold text-green-600" id="growingDong">0</div>
                <div class="text-sm text-gray-600">ì¸êµ¬ ì¦ê°€</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold text-red-600" id="decliningDong">0</div>
                <div class="text-sm text-gray-600">ì¸êµ¬ ê°ì†Œ</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold text-yellow-600" id="stableDong">0</div>
                <div class="text-sm text-gray-600">ì•ˆì •ì </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold text-purple-600" id="selectedDong">0</div>
                <div class="text-sm text-gray-600">ì„ íƒë¨</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold text-indigo-600" id="avgChangeRate">0.0%</div>
                <div class="text-sm text-gray-600">í‰ê·  ì¦ê°ë¥ </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì§€ë„ -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-3">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">í–‰ì •ë™ë³„ ì¸êµ¬ë³€í™” ì§€ë„</h2>
                        <div class="flex space-x-2">
                            <button onclick="zoomIn()" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸ”+</button>
                            <button onclick="zoomOut()" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸ”-</button>
                            <button onclick="resetZoom()" class="px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700">ğŸ”„</button>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <svg id="dongMapSvg" viewBox="0 0 1200 800" class="w-full h-auto border border-gray-200 rounded-lg bg-gray-50">
                            <!-- ë²”ë¡€ -->
                            <g id="populationLegend" class="population-legend" transform="translate(20, 20)">
                                <rect x="0" y="0" width="200" height="200" fill="white" stroke="#ccc" stroke-width="1" rx="8" opacity="0.95"/>
                                <text x="100" y="20" text-anchor="middle" class="text-sm font-bold fill-gray-800">ì¸êµ¬ ë³€í™”ìœ¨ (%)</text>
                                
                                <circle cx="20" cy="45" r="8" fill="#059669"/>
                                <text x="35" y="50" class="text-xs fill-gray-700">+5% ì´ìƒ (ê¸‰ì„±ì¥)</text>
                                
                                <circle cx="20" cy="70" r="8" fill="#10B981"/>
                                <text x="35" y="75" class="text-xs fill-gray-700">+2~5% (ì„±ì¥)</text>
                                
                                <circle cx="20" cy="95" r="8" fill="#6EE7B7"/>
                                <text x="35" y="100" class="text-xs fill-gray-700">0~2% (ë¯¸ì„±ì¥)</text>
                                
                                <circle cx="20" cy="120" r="8" fill="#FEF3C7"/>
                                <text x="35" y="125" class="text-xs fill-gray-700">0~-2% (ë¯¸ê°ì†Œ)</text>
                                
                                <circle cx="20" cy="145" r="8" fill="#F59E0B"/>
                                <text x="35" y="150" class="text-xs fill-gray-700">-2~-5% (ê°ì†Œ)</text>
                                
                                <circle cx="20" cy="170" r="8" fill="#DC2626"/>
                                <text x="35" y="175" class="text-xs fill-gray-700">-5% ì´í•˜ (ê¸‰ê°ì†Œ)</text>
                                
                                <text x="100" y="195" text-anchor="middle" class="text-xs fill-gray-600">í´ë¦­: ìƒì„¸ ë¶„ì„</text>
                            </g>

                            <!-- í–‰ì •ë™ í¬ì¸íŠ¸ë“¤ (ë™ì  ìƒì„±) -->
                            <g id="dongPoints"></g>
                            
                            <!-- ì§€ì—­ ê²½ê³„ì„  (ì„ íƒì ) -->
                            <g id="regionBoundaries"></g>
                        </svg>
                        
                        <div id="tooltip" class="tooltip hidden"></div>
                    </div>
                </div>
            </div>

            <!-- ë¶„ì„ íŒ¨ë„ -->
            <div class="lg:col-span-1">
                <div class="space-y-6">
                    <!-- ì„ íƒëœ ë™ ìƒì„¸ ì •ë³´ -->
                    <div id="dongDetailPanel" class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“ ì„ íƒëœ ì§€ì—­</h3>
                        <div id="dongDetailContent" class="text-sm text-gray-500">
                            í–‰ì •ë™ì„ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <!-- ì¸êµ¬ ë³€í™” ì°¨íŠ¸ -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ ì¸êµ¬ ë³€í™” ì¶”ì´</h3>
                        <div id="populationChart" class="h-48 bg-gray-50 rounded flex items-center justify-center">
                            <span class="text-gray-500">ì§€ì—­ ì„ íƒ ì‹œ ì°¨íŠ¸ í‘œì‹œ</span>
                        </div>
                    </div>

                    <!-- ì§€ì—­ í†µê³„ -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“Š ì§€ì—­ í†µê³„</h3>
                        <div id="regionalStats" class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">í‰ê·  ì¸êµ¬:</span>
                                <span class="font-medium" id="avgPopulation">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ìµœëŒ€ ì¸êµ¬:</span>
                                <span class="font-medium" id="maxPopulation">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ìµœì†Œ ì¸êµ¬:</span>
                                <span class="font-medium" id="minPopulation">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ì¦ê°ë¥ :</span>
                                <span class="font-medium" id="changeRate">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- í•«ìŠ¤íŒŸ ì •ë³´ -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ”¥ ì¸êµ¬ë³€í™” í•«ìŠ¤íŒŸ</h3>
                        <div class="space-y-3">
                            <div class="bg-green-50 p-3 rounded">
                                <div class="font-medium text-green-800">ê¸‰ì„±ì¥ ì§€ì—­</div>
                                <div class="text-sm text-green-600" id="growthHotspot">í™”ì„±ì‹œ ë™íƒ„ì‹ ë„ì‹œ (+15.2%)</div>
                            </div>
                            <div class="bg-red-50 p-3 rounded">
                                <div class="font-medium text-red-800">ê¸‰ê°ì†Œ ì§€ì—­</div>
                                <div class="text-sm text-red-600" id="declineHotspot">ê³ í¥êµ° ë†ì´Œì§€ì—­ (-8.3%)</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="font-medium text-blue-800">ì£¼ëª© ì§€ì—­</div>
                                <div class="text-sm text-blue-600" id="watchArea">ì„¸ì¢…ì‹œ ì‹ ë„ì‹œ (+12.1%)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìƒì„¸ ë¶„ì„ ëª¨ë‹¬ -->
        <div id="dongDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto shadow-2xl">
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 relative">
                    <button onclick="closeDongModal()" class="absolute top-4 right-4 text-white hover:text-gray-200 text-2xl font-bold">Ã—</button>
                    <div id="modalHeader">
                        <h2 class="text-2xl font-bold" id="modalTitle">í–‰ì •ë™ ìƒì„¸ ë¶„ì„</h2>
                        <p class="text-blue-100" id="modalSubtitle">2014-2025ë…„ ì¸êµ¬ë³€í™” ë¶„ì„</p>
                    </div>
                </div>
                <div id="modalContent" class="p-6">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ìƒì„¸ ë¶„ì„ ë‚´ìš© -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „êµ­ í–‰ì •ë™ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°
        let dongData = {};
        let currentYear = 2024;
        let selectedRegion = '';
        let analysisMode = 'population';
        let isAnimating = false;
        let zoomLevel = 1;

        // ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ìƒì„±
        function generateDongData() {
            console.log('ğŸ˜ï¸ í–‰ì •ë™ ë°ì´í„° ìƒì„± ì‹œì‘');
            
            const regions = {
                'ì„œìš¸íŠ¹ë³„ì‹œ': {count: 467, baseX: 300, baseY: 150, spread: 80},
                'ë¶€ì‚°ê´‘ì—­ì‹œ': {count: 201, baseX: 850, baseY: 520, spread: 60},
                'ëŒ€êµ¬ê´‘ì—­ì‹œ': {count: 139, baseX: 750, baseY: 450, spread: 50},
                'ì¸ì²œê´‘ì—­ì‹œ': {count: 152, baseX: 200, baseY: 200, spread: 60},
                'ê´‘ì£¼ê´‘ì—­ì‹œ': {count: 95, baseX: 400, baseY: 500, spread: 40},
                'ëŒ€ì „ê´‘ì—­ì‹œ': {count: 79, baseX: 500, baseY: 350, spread: 40},
                'ìš¸ì‚°ê´‘ì—­ì‹œ': {count: 56, baseX: 850, baseY: 480, spread: 35},
                'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': {count: 20, baseX: 450, baseY: 320, spread: 25},
                'ê²½ê¸°ë„': {count: 573, baseX: 350, baseY: 200, spread: 120},
                'ê°•ì›íŠ¹ë³„ìì¹˜ë„': {count: 179, baseX: 650, baseY: 200, spread: 80},
                'ì¶©ì²­ë¶ë„': {count: 153, baseX: 550, baseY: 300, spread: 60},
                'ì¶©ì²­ë‚¨ë„': {count: 212, baseX: 400, baseY: 320, spread: 70},
                'ì „ë¶íŠ¹ë³„ìì¹˜ë„': {count: 179, baseX: 450, baseY: 420, spread: 70},
                'ì „ë¼ë‚¨ë„': {count: 196, baseX: 400, baseY: 550, spread: 80},
                'ê²½ìƒë¶ë„': {count: 276, baseX: 700, baseY: 350, spread: 90},
                'ê²½ìƒë‚¨ë„': {count: 279, baseX: 750, baseY: 520, spread: 80},
                'ì œì£¼íŠ¹ë³„ìì¹˜ë„': {count: 43, baseX: 300, baseY: 720, spread: 40}
            };

            dongData = {};
            let totalGenerated = 0;

            Object.entries(regions).forEach(([regionName, regionInfo]) => {
                dongData[regionName] = [];
                
                for (let i = 0; i < regionInfo.count; i++) {
                    // ëœë¤ ì¢Œí‘œ ìƒì„± (ì§€ì—­ ë²”ìœ„ ë‚´)
                    const angle = (Math.PI * 2 / regionInfo.count) * i + Math.random() * 0.5;
                    const distance = Math.random() * regionInfo.spread;
                    
                    const x = regionInfo.baseX + Math.cos(angle) * distance;
                    const y = regionInfo.baseY + Math.sin(angle) * distance;
                    
                    // 12ë…„ê°„ ì¸êµ¬ ë³€í™” ì‹œë®¬ë ˆì´ì…˜
                    const populationHistory = generatePopulationHistory(regionName, i);
                    
                    const dongInfo = {
                        id: `${regionName}_dong_${i+1:03d}`,
                        name: `${regionName.slice(0,2)}${i+1}ë™`,
                        region: regionName,
                        coordinates: {x: Math.round(x), y: Math.round(y)},
                        populationHistory: populationHistory,
                        characteristics: getDongCharacteristics(regionName, i)
                    };
                    
                    dongData[regionName].push(dongInfo);
                    totalGenerated++;
                }
            });

            console.log(`âœ… ìƒì„± ì™„ë£Œ: ${totalGenerated}ê°œ í–‰ì •ë™`);
            return dongData;
        }

        function generatePopulationHistory(regionName, index) {
            const history = {};
            
            // ì§€ì—­ë³„ ê¸°ë³¸ ì¸êµ¬ ë²”ìœ„
            const baseRanges = {
                'ì„œìš¸íŠ¹ë³„ì‹œ': {min: 15000, max: 45000},
                'ê²½ê¸°ë„': {min: 12000, max: 60000},
                'ë¶€ì‚°ê´‘ì—­ì‹œ': {min: 8000, max: 35000}
            };
            
            const range = baseRanges[regionName] || {min: 8000, max: 30000};
            let currentPop = Math.floor(Math.random() * (range.max - range.min) + range.min);
            
            for (let year = 2014; year <= 2025; year++) {
                // ì—°ë„ë³„ ë³€í™”ìœ¨ (ì§€ì—­ íŠ¹ì„± ë°˜ì˜)
                let changeRate;
                
                if (regionName === 'ê²½ê¸°ë„' && Math.random() > 0.7) {
                    changeRate = Math.random() * 8 - 1; // ì‹ ë„ì‹œ ê°œë°œ
                } else if (regionName.includes('ê´‘ì—­ì‹œ') && year > 2020) {
                    changeRate = Math.random() * 2 - 3; // ê´‘ì—­ì‹œ ê°ì†Œ
                } else {
                    changeRate = Math.random() * 4 - 2; // ì¼ë°˜ì  ë³€í™”
                }
                
                currentPop = Math.max(1000, Math.floor(currentPop * (1 + changeRate / 100)));
                
                history[year] = {
                    population: currentPop,
                    changeRate: Math.round(changeRate * 100) / 100,
                    density: Math.round(currentPop / Math.random() * 10 + 5000),
                    agingRatio: Math.round((Math.random() * 20 + 10) * 100) / 100,
                    youthRatio: Math.round((Math.random() * 25 + 15) * 100) / 100
                };
            }
            
            return history;
        }

        function getDongCharacteristics(regionName, index) {
            const types = ['ì£¼ê±°ì§€ì—­', 'ìƒì—…ì§€ì—­', 'ì‚°ì—…ì§€ì—­', 'í˜¼í•©ì§€ì—­'];
            const levels = ['ìƒ', 'ì¤‘ìƒ', 'ì¤‘', 'ì¤‘í•˜', 'í•˜'];
            
            return {
                type: types[index % types.length],
                economicLevel: levels[index % levels.length],
                keyFeatures: ['êµí†µí¸ë¦¬', 'êµìœ¡í™˜ê²½', 'ìƒì—…ì‹œì„¤'].filter(() => Math.random() > 0.5)
            };
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í–‰ì •ë™ ì§€ë„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”');
            dongData = generateDongData();
            initializeDongMap();
            updateMapByYear(2024);
            updateStatistics();
        });

        function initializeDongMap() {
            const svg = d3.select("#dongMapSvg");
            const pointsGroup = svg.select("#dongPoints");
            
            // ëª¨ë“  í–‰ì •ë™ í¬ì¸íŠ¸ ìƒì„±
            Object.entries(dongData).forEach(([regionName, dongList]) => {
                const regionGroup = pointsGroup.append("g")
                    .attr("class", "region-group")
                    .attr("data-region", regionName);
                
                dongList.forEach(dong => {
                    const circle = regionGroup.append("circle")
                        .attr("cx", dong.coordinates.x)
                        .attr("cy", dong.coordinates.y)
                        .attr("r", 3)
                        .attr("class", "dong-point")
                        .attr("data-dong-id", dong.id)
                        .attr("fill", getDongColor(dong, analysisMode))
                        .attr("stroke", "#374151")
                        .attr("stroke-width", 1)
                        .on("click", () => selectDong(dong))
                        .on("mouseenter", (event) => showDongTooltip(event, dong))
                        .on("mouseleave", hideTooltip);
                });
            });
            
            console.log('ğŸ—ºï¸ í–‰ì •ë™ í¬ì¸íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        function getDongColor(dong, mode) {
            const currentData = dong.populationHistory[currentYear];
            if (!currentData) return '#E5E7EB';
            
            switch(mode) {
                case 'population':
                    const pop = currentData.population;
                    if (pop > 40000) return '#059669';
                    if (pop > 30000) return '#10B981';
                    if (pop > 20000) return '#6EE7B7';
                    if (pop > 10000) return '#FEF3C7';
                    return '#F59E0B';
                    
                case 'change_rate':
                    const rate = currentData.changeRate;
                    if (rate > 5) return '#059669';
                    if (rate > 2) return '#10B981';
                    if (rate > 0) return '#6EE7B7';
                    if (rate > -2) return '#FEF3C7';
                    if (rate > -5) return '#F59E0B';
                    return '#DC2626';
                    
                case 'aging':
                    const aging = currentData.agingRatio;
                    if (aging > 25) return '#7C2D12';
                    if (aging > 20) return '#DC2626';
                    if (aging > 15) return '#F59E0B';
                    if (aging > 10) return '#FEF3C7';
                    return '#6EE7B7';
                    
                default:
                    return '#3B82F6';
            }
        }

        function updateMapByYear(year) {
            currentYear = parseInt(year);
            document.getElementById('currentYear').textContent = year;
            
            // ëª¨ë“  ë™ í¬ì¸íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            d3.selectAll(".dong-point")
                .transition()
                .duration(300)
                .attr("fill", function() {
                    const dongId = d3.select(this).attr("data-dong-id");
                    const dong = findDongById(dongId);
                    return dong ? getDongColor(dong, analysisMode) : '#E5E7EB';
                })
                .attr("r", function() {
                    const dongId = d3.select(this).attr("data-dong-id");
                    const dong = findDongById(dongId);
                    if (!dong) return 3;
                    
                    const population = dong.populationHistory[currentYear]?.population || 0;
                    return Math.max(2, Math.min(8, population / 8000)); // ì¸êµ¬ì— ë”°ë¥¸ í¬ê¸° ì¡°ì ˆ
                });
            
            updateStatistics();
        }

        function selectRegion(regionName) {
            selectedRegion = regionName;
            
            if (regionName) {
                // ì„ íƒëœ ì§€ì—­ í™•ëŒ€
                const regionData = dongData[regionName];
                if (regionData && regionData.length > 0) {
                    // ì§€ì—­ ê²½ê³„ ê³„ì‚°
                    const xCoords = regionData.map(d => d.coordinates.x);
                    const yCoords = regionData.map(d => d.coordinates.y);
                    
                    const minX = Math.min(...xCoords) - 50;
                    const maxX = Math.max(...xCoords) + 50;
                    const minY = Math.min(...yCoords) - 50;
                    const maxY = Math.max(...yCoords) + 50;
                    
                    // SVG ë·°ë°•ìŠ¤ ì¡°ì •
                    const svg = document.getElementById('dongMapSvg');
                    svg.setAttribute('viewBox', `${minX} ${minY} ${maxX - minX} ${maxY - minY}`);
                    
                    // ë‹¤ë¥¸ ì§€ì—­ íˆ¬ëª…ë„ ì¡°ì ˆ
                    d3.selectAll(".region-group")
                        .transition()
                        .duration(500)
                        .style("opacity", function() {
                            const region = d3.select(this).attr("data-region");
                            return region === regionName ? 1 : 0.3;
                        });
                    
                    updateRegionalStats(regionName);
                }
            } else {
                // ì „êµ­ ë³´ê¸°ë¡œ ë³µì›
                resetZoom();
            }
        }

        function updateRegionalStats(regionName) {
            const regionData = dongData[regionName];
            if (!regionData) return;
            
            const populations = regionData.map(d => d.populationHistory[currentYear]?.population || 0);
            const changeRates = regionData.map(d => d.populationHistory[currentYear]?.changeRate || 0);
            
            const avgPop = Math.round(populations.reduce((a, b) => a + b, 0) / populations.length);
            const maxPop = Math.max(...populations);
            const minPop = Math.min(...populations);
            const avgChange = Math.round((changeRates.reduce((a, b) => a + b, 0) / changeRates.length) * 100) / 100;
            
            document.getElementById('avgPopulation').textContent = avgPop.toLocaleString() + 'ëª…';
            document.getElementById('maxPopulation').textContent = maxPop.toLocaleString() + 'ëª…';
            document.getElementById('minPopulation').textContent = minPop.toLocaleString() + 'ëª…';
            document.getElementById('changeRate').textContent = avgChange + '%';
        }

        function selectDong(dong) {
            const currentData = dong.populationHistory[currentYear];
            
            const content = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded">
                            <div class="text-sm text-blue-600">í˜„ì¬ ì¸êµ¬</div>
                            <div class="text-2xl font-bold text-blue-800">${currentData.population.toLocaleString()}ëª…</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded">
                            <div class="text-sm text-green-600">ì¸êµ¬ ë³€í™”ìœ¨</div>
                            <div class="text-2xl font-bold ${currentData.changeRate > 0 ? 'text-green-800' : 'text-red-800'}">
                                ${currentData.changeRate > 0 ? '+' : ''}${currentData.changeRate}%
                            </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded">
                            <div class="text-sm text-purple-600">ê³ ë ¹í™”ìœ¨</div>
                            <div class="text-2xl font-bold text-purple-800">${currentData.agingRatio}%</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded">
                            <div class="text-sm text-orange-600">ì²­ë…„ ë¹„ìœ¨</div>
                            <div class="text-2xl font-bold text-orange-800">${currentData.youthRatio}%</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded">
                        <div class="font-medium mb-2">ì§€ì—­ íŠ¹ì„±</div>
                        <div class="text-sm space-y-1">
                            <div>ğŸ  ì§€ì—­ ìœ í˜•: ${dong.characteristics.type}</div>
                            <div>ğŸ’° ê²½ì œ ìˆ˜ì¤€: ${dong.characteristics.economicLevel}</div>
                            <div>ğŸ·ï¸ ì£¼ìš” íŠ¹ì§•: ${dong.characteristics.keyFeatures.join(', ') || 'ì¼ë°˜ ì£¼ê±°ì§€ì—­'}</div>
                        </div>
                    </div>
                    
                    <button onclick="showDetailedAnalysis('${dong.id}')" 
                            class="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        ğŸ“Š ìƒì„¸ ë¶„ì„ ë³´ê¸°
                    </button>
                </div>
            `;
            
            document.getElementById('dongDetailContent').innerHTML = content;
            document.getElementById('selectedDong').textContent = '1';
            
            // ì„ íƒëœ ë™ í•˜ì´ë¼ì´íŠ¸
            d3.selectAll(".dong-point").attr("stroke-width", 1);
            d3.select(`[data-dong-id="${dong.id}"]`)
                .attr("stroke-width", 4)
                .attr("stroke", "#EF4444");
        }

        function showDongTooltip(event, dong) {
            const currentData = dong.populationHistory[currentYear];
            
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <div><strong>${dong.name}</strong></div>
                <div>${dong.region}</div>
                <div>ì¸êµ¬: ${currentData.population.toLocaleString()}ëª…</div>
                <div>ë³€í™”ìœ¨: ${currentData.changeRate > 0 ? '+' : ''}${currentData.changeRate}%</div>
                <div>ê³ ë ¹í™”: ${currentData.agingRatio}%</div>
                <div class="text-xs mt-1 opacity-75">í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´</div>
            `;
            
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.classList.remove('hidden');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.add('hidden');
        }

        function updateStatistics() {
            let growing = 0, declining = 0, stable = 0;
            let totalChangeRate = 0, totalDong = 0;
            
            Object.values(dongData).forEach(dongList => {
                dongList.forEach(dong => {
                    const currentData = dong.populationHistory[currentYear];
                    if (currentData) {
                        totalDong++;
                        totalChangeRate += currentData.changeRate;
                        
                        if (currentData.changeRate > 1) growing++;
                        else if (currentData.changeRate < -1) declining++;
                        else stable++;
                    }
                });
            });
            
            document.getElementById('growingDong').textContent = growing;
            document.getElementById('decliningDong').textContent = declining;
            document.getElementById('stableDong').textContent = stable;
            document.getElementById('avgChangeRate').textContent = 
                totalDong > 0 ? (Math.round((totalChangeRate / totalDong) * 100) / 100) + '%' : '0.0%';
        }

        function changeAnalysisMode(mode) {
            analysisMode = mode;
            updateMapByYear(currentYear);
        }

        function playAnimation() {
            if (isAnimating) return;
            
            isAnimating = true;
            document.getElementById('playBtn').textContent = 'â¸ï¸ ì •ì§€';
            
            let year = 2014;
            const interval = setInterval(() => {
                if (!isAnimating || year > 2025) {
                    clearInterval(interval);
                    isAnimating = false;
                    document.getElementById('playBtn').textContent = 'â–¶ï¸ ì¬ìƒ';
                    return;
                }
                
                document.getElementById('yearSlider').value = year;
                updateMapByYear(year);
                year++;
            }, 800);
        }

        function resetMap() {
            selectedRegion = '';
            document.getElementById('regionSelector').value = '';
            resetZoom();
            d3.selectAll(".region-group").style("opacity", 1);
            d3.selectAll(".dong-point").attr("stroke-width", 1);
            document.getElementById('selectedDong').textContent = '0';
        }

        function resetZoom() {
            document.getElementById('dongMapSvg').setAttribute('viewBox', '0 0 1200 800');
            zoomLevel = 1;
        }

        function zoomIn() {
            zoomLevel *= 1.2;
            // ì¤Œ êµ¬í˜„ (ì¤‘ì‹¬ì  ê¸°ì¤€)
        }

        function zoomOut() {
            zoomLevel /= 1.2;
            // ì¤Œ ì•„ì›ƒ êµ¬í˜„
        }

        function findDongById(dongId) {
            for (const dongList of Object.values(dongData)) {
                const found = dongList.find(d => d.id === dongId);
                if (found) return found;
            }
            return null;
        }

        function showDetailedAnalysis(dongId) {
            const dong = findDongById(dongId);
            if (!dong) return;
            
            document.getElementById('modalTitle').textContent = dong.name + ' ìƒì„¸ ë¶„ì„';
            document.getElementById('modalSubtitle').textContent = `${dong.region} ì†Œì† í–‰ì •ë™`;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-3">ğŸ“Š 12ë…„ê°„ ì¸êµ¬ ë³€í™”</h3>
                            <div class="space-y-2 text-sm">
                                ${Object.entries(dong.populationHistory).map(([year, data]) => `
                                    <div class="flex justify-between items-center p-2 ${year == currentYear ? 'bg-blue-50 font-bold' : 'hover:bg-gray-50'} rounded">
                                        <span>${year}ë…„</span>
                                        <span>${data.population.toLocaleString()}ëª…</span>
                                        <span class="${data.changeRate > 0 ? 'text-green-600' : 'text-red-600'}">
                                            ${data.changeRate > 0 ? '+' : ''}${data.changeRate}%
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-3">ğŸ¯ ì„ ê±° ì˜í–¥ ë¶„ì„</h3>
                            <div class="space-y-3">
                                <div class="bg-blue-50 p-4 rounded">
                                    <div class="font-medium">ì¸êµ¬ íŠ¸ë Œë“œ</div>
                                    <div class="text-sm text-blue-600">
                                        ${dong.populationHistory[currentYear].changeRate > 0 ? 'ì¦ê°€ ì¶”ì„¸' : 'ê°ì†Œ ì¶”ì„¸'}
                                    </div>
                                </div>
                                <div class="bg-green-50 p-4 rounded">
                                    <div class="font-medium">ì„ ê±° ì˜í–¥ë„</div>
                                    <div class="text-sm text-green-600">
                                        ${Math.abs(dong.populationHistory[currentYear].changeRate) > 3 ? 'ë†’ìŒ' : 'ë³´í†µ'}
                                    </div>
                                </div>
                                <div class="bg-purple-50 p-4 rounded">
                                    <div class="font-medium">ì˜ˆì¸¡ ì‹ ë¢°ë„</div>
                                    <div class="text-sm text-purple-600">85%+</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('dongDetailModal').classList.remove('hidden');
        }

        function closeDongModal() {
            document.getElementById('dongDetailModal').classList.add('hidden');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('dongDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDongModal();
            }
        });

        console.log('ğŸ˜ï¸ ì „êµ­ í–‰ì •ë™ë³„ ì¸êµ¬ë³€í™” ì§€ë„ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
