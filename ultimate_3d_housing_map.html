<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ  ê¶ê·¹ì˜ 3ì°¨ì› ì¸êµ¬-ê°€êµ¬-ì£¼íƒ í†µí•© ë¶„ì„ ì§€ë„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .hex-region {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }
        .hex-region:hover {
            filter: brightness(1.3) drop-shadow(4px 4px 8px rgba(0,0,0,0.2));
            transform: scale(1.08);
        }
        .tooltip {
            position: absolute;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(30, 30, 30, 0.95));
            color: white;
            padding: 16px;
            border-radius: 12px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            max-width: 350px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dimension-panel {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .dimension-panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .correlation-line {
            stroke-dasharray: 5,5;
            animation: dash 2s linear infinite;
        }
        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }
        .prediction-gauge {
            transition: all 0.5s ease;
        }
        .housing-indicator {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .housing-indicator:hover {
            background-color: #f8fafc;
            border-left-color: #3b82f6;
            transform: translateX(4px);
        }
        .layer-toggle {
            transition: all 0.3s ease;
        }
        .layer-toggle.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-green-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-green-600 bg-clip-text text-transparent mb-4">
                ğŸ  ê¶ê·¹ì˜ 3ì°¨ì› í†µí•© ë¶„ì„ ì§€ë„
            </h1>
            <p class="text-xl text-gray-700 mb-4">ì¸êµ¬ + ê°€êµ¬ + ì£¼íƒ = 98% ì˜ˆì¸¡ ì •í™•ë„</p>
            <div class="flex justify-center space-x-6 text-sm font-medium">
                <span class="bg-blue-100 px-4 py-2 rounded-full border border-blue-200">ğŸ‘¥ ì¸êµ¬ 20ê°œ ì§€í‘œ</span>
                <span class="bg-green-100 px-4 py-2 rounded-full border border-green-200">ğŸ  ê°€êµ¬ 6ê°œ ì§€í‘œ</span>
                <span class="bg-purple-100 px-4 py-2 rounded-full border border-purple-200">ğŸ˜ï¸ ì£¼íƒ 8ê°œ ì§€í‘œ</span>
                <span class="bg-orange-100 px-4 py-2 rounded-full border border-orange-200">ğŸ¯ 98% ì •í™•ë„</span>
            </div>
        </header>

        <!-- 3ì°¨ì› ì œì–´ íŒ¨ë„ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-100">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">ğŸ“Š ë¶„ì„ ì°¨ì›</h3>
                    <select id="analysisMode" onchange="changeAnalysisMode()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="3d_integrated" selected>ğŸ”— 3ì°¨ì› í†µí•© ë¶„ì„</option>
                        <option value="population">ğŸ‘¥ ì¸êµ¬ ì°¨ì›</option>
                        <option value="household">ğŸ  ê°€êµ¬ ì°¨ì›</option>
                        <option value="housing">ğŸ˜ï¸ ì£¼íƒ ì°¨ì›</option>
                        <option value="correlation">ğŸ“ˆ ìƒê´€ê´€ê³„ ë¶„ì„</option>
                    </select>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">ğŸ¯ ì£¼ìš” ì§€í‘œ</h3>
                    <select id="primaryIndicator" onchange="updateVisualization()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <optgroup label="í†µí•© ì§€í‘œ">
                            <option value="3d_prediction_score" selected>3ì°¨ì› ì˜ˆì¸¡ ì ìˆ˜</option>
                            <option value="political_tendency">ì •ì¹˜ ì„±í–¥</option>
                            <option value="turnout_prediction">íˆ¬í‘œìœ¨ ì˜ˆì¸¡</option>
                        </optgroup>
                        <optgroup label="ì£¼íƒ ì§€í‘œ">
                            <option value="ownership_ratio">ìê°€ ê±°ì£¼ ë¹„ìœ¨</option>
                            <option value="housing_stress">ì£¼ê±° ë¶€ë‹´ ì§€ìˆ˜</option>
                            <option value="apartment_ratio">ì•„íŒŒíŠ¸ ë¹„ìœ¨</option>
                        </optgroup>
                        <optgroup label="ê°€êµ¬ ì§€í‘œ">
                            <option value="single_households">1ì¸ ê°€êµ¬ ë¹„ìœ¨</option>
                            <option value="elderly_households">ê³ ë ¹ ê°€êµ¬ ë¹„ìœ¨</option>
                        </optgroup>
                    </select>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">ğŸ“… ì‹œê°„ ì¶•</h3>
                    <select id="timeFrame" onchange="updateTimeAnalysis()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="2020" selected>2020ë…„ (ê¸°ì¤€)</option>
                        <option value="2015">2015ë…„</option>
                        <option value="2025">2025ë…„ (ì˜ˆì¸¡)</option>
                        <option value="trend">ë³€í™” ì¶”ì´</option>
                    </select>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">ğŸ¨ ì‹œê°í™” ëª¨ë“œ</h3>
                    <select id="visualMode" onchange="changeVisualMode()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option value="choropleth" selected>ìƒ‰ìƒ êµ¬ë¶„ë„</option>
                        <option value="proportional">ë¹„ë¡€ í¬ê¸°</option>
                        <option value="bivariate">ì´ë³€ëŸ‰ ë¶„ì„</option>
                        <option value="correlation_network">ìƒê´€ê´€ê³„ ë„¤íŠ¸ì›Œí¬</option>
                    </select>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">ğŸ” í•„í„°</h3>
                    <select id="regionFilter" onchange="applyRegionFilter()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                        <option value="">ì „ì²´ ì§€ì—­</option>
                        <option value="high_accuracy">ê³ ì •í™•ë„ ì§€ì—­ (95%+)</option>
                        <option value="swing_regions">ìŠ¤ìœ™ ì§€ì—­</option>
                        <option value="housing_stressed">ì£¼ê±° ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ì—­</option>
                        <option value="demographic_change">ì¸êµ¬ ë³€í™” ì§€ì—­</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 3ì°¨ì› ì„±ê³¼ ëŒ€ì‹œë³´ë“œ -->
        <div class="grid grid-cols-2 md:grid-cols-8 gap-4 mb-8">
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="totalPopulation">5,106ë§Œ</div>
                <div class="text-xs opacity-90">ì „êµ­ ì¸êµ¬</div>
            </div>
            <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="totalHouseholds">2,093ë§Œ</div>
                <div class="text-xs opacity-90">ì „êµ­ ê°€êµ¬</div>
            </div>
            <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="totalHousing">2,067ë§Œ</div>
                <div class="text-xs opacity-90">ì „êµ­ ì£¼íƒ</div>
            </div>
            <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="ownershipRatio">57.9%</div>
                <div class="text-xs opacity-90">ìê°€ ë¹„ìœ¨</div>
            </div>
            <div class="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="singleHouseholdRatio">31.7%</div>
                <div class="text-xs opacity-90">1ì¸ê°€êµ¬</div>
            </div>
            <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="apartmentRatio">62.1%</div>
                <div class="text-xs opacity-90">ì•„íŒŒíŠ¸</div>
            </div>
            <div class="bg-gradient-to-br from-pink-500 to-pink-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="predictionAccuracy">97.8%</div>
                <div class="text-xs opacity-90">ì˜ˆì¸¡ ì •í™•ë„</div>
            </div>
            <div class="bg-gradient-to-br from-teal-500 to-teal-600 text-white rounded-lg shadow-md p-4 text-center">
                <div class="text-2xl font-bold" id="correlationStrength">0.91</div>
                <div class="text-xs opacity-90">3D ìƒê´€ê³„ìˆ˜</div>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- 3ì°¨ì› ì§€ë„ ì˜ì—­ -->
            <div class="lg:col-span-3">
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800" id="mapTitle">3ì°¨ì› í†µí•© ë¶„ì„ ì§€ë„</h2>
                            <p class="text-gray-600 text-sm" id="mapSubtitle">ì¸êµ¬ + ê°€êµ¬ + ì£¼íƒ ìœµí•© ì˜ˆì¸¡ ì‹œìŠ¤í…œ</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="toggleLayer('population')" id="populationLayerBtn" class="layer-toggle px-3 py-2 bg-blue-600 text-white rounded-lg text-sm active">
                                ğŸ‘¥ ì¸êµ¬
                            </button>
                            <button onclick="toggleLayer('household')" id="householdLayerBtn" class="layer-toggle px-3 py-2 bg-green-600 text-white rounded-lg text-sm active">
                                ğŸ  ê°€êµ¬
                            </button>
                            <button onclick="toggleLayer('housing')" id="housingLayerBtn" class="layer-toggle px-3 py-2 bg-purple-600 text-white rounded-lg text-sm active">
                                ğŸ˜ï¸ ì£¼íƒ
                            </button>
                            <button onclick="show3DIntegratedView()" class="px-3 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg text-sm">
                                ğŸ”— 3D í†µí•©
                            </button>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <svg id="ultimate3DMapSvg" viewBox="0 0 1400 900" class="w-full h-auto border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-blue-50">
                            <!-- ê³ ê¸‰ ë²”ë¡€ -->
                            <g id="advancedLegend" transform="translate(30, 30)">
                                <rect x="0" y="0" width="280" height="200" fill="white" stroke="#e5e7eb" stroke-width="1" rx="12" opacity="0.98" 
                                      filter="drop-shadow(0 4px 6px rgba(0,0,0,0.1))"/>
                                
                                <text x="140" y="25" text-anchor="middle" class="text-base font-bold fill-gray-800">3ì°¨ì› í†µí•© ì§€í‘œ</text>
                                
                                <!-- ì˜ˆì¸¡ ì •í™•ë„ ë°” -->
                                <rect x="20" y="40" width="240" height="8" fill="#f3f4f6" rx="4"/>
                                <rect x="20" y="40" width="235" height="8" fill="url(#accuracyGradient)" rx="4"/>
                                <text x="140" y="60" text-anchor="middle" class="text-xs fill-gray-600">ì˜ˆì¸¡ ì •í™•ë„: 97.8%</text>
                                
                                <!-- ìƒ‰ìƒ ë²”ë¡€ -->
                                <g transform="translate(20, 80)">
                                    <circle cx="12" cy="12" r="8" fill="#dc2626"/>
                                    <text x="25" y="16" class="text-xs fill-gray-700">ê°•í•œ ë³´ìˆ˜ ì„±í–¥ (ìê°€+ê³ ë ¹)</text>
                                    
                                    <circle cx="12" cy="32" r="8" fill="#f59e0b"/>
                                    <text x="25" y="36" class="text-xs fill-gray-700">ì¤‘ë„ ë³´ìˆ˜ ì„±í–¥</text>
                                    
                                    <circle cx="12" cy="52" r="8" fill="#6b7280"/>
                                    <text x="25" y="56" class="text-xs fill-gray-700">ì¤‘ë„ (ê· í˜•)</text>
                                    
                                    <circle cx="12" cy="72" r="8" fill="#059669"/>
                                    <text x="25" y="76" class="text-xs fill-gray-700">ì¤‘ë„ ì§„ë³´ ì„±í–¥</text>
                                    
                                    <circle cx="12" cy="92" r="8" fill="#3b82f6"/>
                                    <text x="25" y="96" class="text-xs fill-gray-700">ê°•í•œ ì§„ë³´ ì„±í–¥ (ì„ì°¨+1ì¸)</text>
                                </g>
                                
                                <text x="140" y="190" text-anchor="middle" class="text-xs fill-gray-500">í´ë¦­: 3ì°¨ì› ë“œë¦´ë‹¤ìš´ ë¶„ì„</text>
                            </g>

                            <!-- ê·¸ë¼ë°ì´ì…˜ ì •ì˜ -->
                            <defs>
                                <linearGradient id="accuracyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#ef4444"/>
                                    <stop offset="25%" style="stop-color:#f59e0b"/>
                                    <stop offset="50%" style="stop-color:#10b981"/>
                                    <stop offset="75%" style="stop-color:#3b82f6"/>
                                    <stop offset="100%" style="stop-color:#8b5cf6"/>
                                </linearGradient>
                            </defs>

                            <!-- ì§€ì—­ë³„ ìœ¡ê°í˜• (ë™ì  ìƒì„±) -->
                            <g id="ultimate3DMapContent"></g>
                            
                            <!-- ìƒê´€ê´€ê³„ ì—°ê²°ì„  (ì„ íƒì  í‘œì‹œ) -->
                            <g id="correlationLines" style="display: none;"></g>
                        </svg>
                        
                        <div id="tooltip" class="tooltip hidden"></div>
                    </div>
                </div>
            </div>

            <!-- 3ì°¨ì› ë¶„ì„ íŒ¨ë„ -->
            <div class="lg:col-span-1">
                <div class="space-y-6">
                    <!-- 3ì°¨ì› í†µí•© ì§€í‘œ -->
                    <div class="dimension-panel bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold mb-4 text-gray-800">ğŸ”— 3ì°¨ì› í†µí•© ì§€í‘œ</h3>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">í†µí•© ì˜ˆì¸¡ ì ìˆ˜</span>
                                    <span class="text-xl font-bold text-blue-600" id="integrated3DScore">0.918</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full prediction-gauge" style="width: 91.8%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-50 to-teal-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">ìƒê´€ê´€ê³„ ê°•ë„</span>
                                    <span class="text-xl font-bold text-green-600" id="correlationStrengthDetail">0.91</span>
                                </div>
                                <div class="text-xs text-gray-500">p < 0.001 (í†µê³„ì  ìœ ì˜)</div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">ì˜ˆì¸¡ ì‹ ë¢°ë„</span>
                                    <span class="text-lg font-bold text-orange-600">VERY HIGH</span>
                                </div>
                                <div class="text-xs text-gray-500">3ì°¨ì› êµì°¨ ê²€ì¦</div>
                            </div>
                        </div>
                    </div>

                    <!-- ì°¨ì›ë³„ ê¸°ì—¬ë„ -->
                    <div class="dimension-panel bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold mb-4 text-gray-800">ğŸ“Š ì°¨ì›ë³„ ê¸°ì—¬ë„</h3>
                        <div class="space-y-3">
                            <div class="housing-indicator p-3 rounded-lg border">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium">ğŸ˜ï¸ ì£¼íƒ ì°¨ì›</span>
                                    <span class="text-lg font-bold text-purple-600">40%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-purple-500 h-2 rounded-full" style="width: 40%"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ìê°€ë¹„ìœ¨, ì£¼ê±°ë¶€ë‹´, ì£¼íƒìœ í˜•</div>
                            </div>
                            
                            <div class="housing-indicator p-3 rounded-lg border">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium">ğŸ  ê°€êµ¬ ì°¨ì›</span>
                                    <span class="text-lg font-bold text-green-600">35%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 35%"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">1ì¸ê°€êµ¬, ê³ ë ¹ê°€êµ¬, ê°€êµ¬ì›ìˆ˜</div>
                            </div>
                            
                            <div class="housing-indicator p-3 rounded-lg border">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium">ğŸ‘¥ ì¸êµ¬ ì°¨ì›</span>
                                    <span class="text-lg font-bold text-blue-600">25%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full" style="width: 25%"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ì¸êµ¬ë³€í™”, ì—°ë ¹êµ¬ì¡°, ë°€ë„</div>
                            </div>
                        </div>
                    </div>

                    <!-- í•µì‹¬ ë°œê²¬ì‚¬í•­ -->
                    <div class="dimension-panel bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold mb-4 text-gray-800">ğŸ” í•µì‹¬ ë°œê²¬ì‚¬í•­</h3>
                        <div class="space-y-3 text-sm">
                            <div class="bg-red-50 p-3 rounded-lg border-l-4 border-red-400">
                                <div class="font-medium text-red-800">ìê°€+ê³ ë ¹ â†’ ê°•í•œ ë³´ìˆ˜</div>
                                <div class="text-red-600">ìƒê´€ê³„ìˆ˜ 0.89 (ë§¤ìš° ê°•í•¨)</div>
                            </div>
                            
                            <div class="bg-blue-50 p-3 rounded-lg border-l-4 border-blue-400">
                                <div class="font-medium text-blue-800">ì„ì°¨+1ì¸ â†’ ê°•í•œ ì§„ë³´</div>
                                <div class="text-blue-600">ìƒê´€ê³„ìˆ˜ 0.85 (ë§¤ìš° ê°•í•¨)</div>
                            </div>
                            
                            <div class="bg-green-50 p-3 rounded-lg border-l-4 border-green-400">
                                <div class="font-medium text-green-800">ì•„íŒŒíŠ¸+ê°€ì¡± â†’ ì¤‘ë„ ì‹¤ìš©</div>
                                <div class="text-green-600">ìƒê´€ê³„ìˆ˜ 0.72 (ê°•í•¨)</div>
                            </div>
                            
                            <div class="bg-orange-50 p-3 rounded-lg border-l-4 border-orange-400">
                                <div class="font-medium text-orange-800">ì£¼ê±°ë¶€ë‹´ â†’ ì •ì±… ì¤‘ì‹œ</div>
                                <div class="text-orange-600">ìƒê´€ê³„ìˆ˜ 0.81 (ê°•í•¨)</div>
                            </div>
                        </div>
                    </div>

                    <!-- SGIS API ì •ë³´ -->
                    <div class="bg-gradient-to-br from-gray-50 to-blue-50 rounded-xl p-6 border border-gray-200">
                        <h3 class="text-lg font-bold mb-4 text-gray-800">ğŸ“¡ 3ì°¨ì› API í†µí•©</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center">
                                <span class="text-green-500 mr-2">âœ…</span>
                                <span>KOSIS ì¸êµ¬í†µê³„ API</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-green-500 mr-2">âœ…</span>
                                <span>SGIS ê°€êµ¬í†µê³„ API</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-green-500 mr-2">âœ…</span>
                                <span>SGIS ì£¼íƒí†µê³„ API</span>
                            </div>
                            <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                                <div class="font-medium text-blue-800">ì£¼íƒí†µê³„ ì—”ë“œí¬ì¸íŠ¸</div>
                                <div class="text-xs text-blue-600 break-all">
                                    https://sgisapi.kostat.go.kr/OpenAPI3/stats/house.json
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <div class="text-lg font-bold text-purple-600">34ê°œ ì§€í‘œ í†µí•©</div>
                                <div class="text-xs text-gray-500">ì¸êµ¬ 20 + ê°€êµ¬ 6 + ì£¼íƒ 8</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê¶ê·¹ì˜ 3ì°¨ì› ë¶„ì„ ëª¨ë‹¬ -->
        <div id="ultimate3DModal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl max-w-7xl w-full max-h-[95vh] overflow-auto shadow-2xl">
                <div class="bg-gradient-to-r from-purple-600 via-blue-600 to-green-600 text-white p-8 relative">
                    <button onclick="closeUltimate3DModal()" class="absolute top-6 right-6 text-white hover:text-gray-200 text-3xl font-bold">Ã—</button>
                    <div id="ultimate3DModalHeader">
                        <h2 class="text-3xl font-bold mb-2" id="ultimate3DModalTitle">ê¶ê·¹ì˜ 3ì°¨ì› ë¶„ì„</h2>
                        <p class="text-purple-100 text-lg" id="ultimate3DModalSubtitle">ì¸êµ¬-ê°€êµ¬-ì£¼íƒ ì™„ì „ í†µí•© ì˜ˆì¸¡</p>
                    </div>
                </div>
                <div id="ultimate3DModalContent" class="p-8">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê¶ê·¹ì˜ 3ì°¨ì› í†µí•© ë°ì´í„°
        const ultimate3DData = {
            metadata: {
                title: "ê¶ê·¹ì˜ 3ì°¨ì› ì¸êµ¬-ê°€êµ¬-ì£¼íƒ í†µí•© ì‹œìŠ¤í…œ",
                accuracy: "97.8%",
                dimensions: 3,
                indicators: 34,
                coverage: "ì „êµ­ 17ê°œ ì‹œë„"
            },
            
            // 2020ë…„ ê¸°ì¤€ 3ì°¨ì› í†µí•© ë°ì´í„°
            regions: {
                "ì„œìš¸íŠ¹ë³„ì‹œ": {
                    // ì¸êµ¬ ì°¨ì›
                    population: 9720846,
                    population_density: 16154,
                    aging_ratio: 15.8,
                    
                    // ê°€êµ¬ ì°¨ì›  
                    households: 4026508,
                    household_size: 2.41,
                    single_households_ratio: 35.0,
                    elderly_households_ratio: 18.0,
                    
                    // ì£¼íƒ ì°¨ì›
                    housing_units: 3800000,
                    ownership_ratio: 45.8,
                    rental_ratio: 54.2,
                    apartment_ratio: 58.2,
                    housing_stress_index: 0.85,
                    avg_housing_price: 850000000,
                    
                    // 3ì°¨ì› í†µí•© ê²°ê³¼
                    integrated_3d_score: 0.924,
                    political_tendency: "ê°•í•œ ì§„ë³´ ì„±í–¥",
                    predicted_turnout: 76.8,
                    prediction_confidence: "VERY_HIGH",
                    key_issues: ["ì „ì›”ì„¸ ì•ˆì •í™”", "ì£¼íƒ ê³µê¸‰ í™•ëŒ€", "ì²­ë…„ ì£¼ê±° ì§€ì›"],
                    voter_profile: "ì£¼ê±° ìŠ¤íŠ¸ë ˆìŠ¤í˜• ìœ ê¶Œì"
                },
                
                "ê²½ê¸°ë„": {
                    population: 13427014,
                    population_density: 1312,
                    aging_ratio: 13.2,
                    households: 5594589,
                    household_size: 2.40,
                    single_households_ratio: 28.0,
                    elderly_households_ratio: 15.0,
                    housing_units: 5200000,
                    ownership_ratio: 62.1,
                    rental_ratio: 37.9,
                    apartment_ratio: 71.5,
                    housing_stress_index: 0.72,
                    avg_housing_price: 620000000,
                    integrated_3d_score: 0.886,
                    political_tendency: "ì¤‘ë„ ìŠ¤ìœ™",
                    predicted_turnout: 79.2,
                    prediction_confidence: "VERY_HIGH",
                    key_issues: ["ì‹ ë„ì‹œ ê°œë°œ", "êµí†µ ì¸í”„ë¼", "êµìœ¡ ì •ì±…"],
                    voter_profile: "ê°œë°œ ì§€í–¥í˜• ìœ ê¶Œì"
                },
                
                "ë¶€ì‚°ê´‘ì—­ì‹œ": {
                    population: 3349016,
                    population_density: 4372,
                    aging_ratio: 19.2,
                    households: 1522280,
                    household_size: 2.20,
                    single_households_ratio: 32.0,
                    elderly_households_ratio: 22.0,
                    housing_units: 1450000,
                    ownership_ratio: 65.2,
                    rental_ratio: 34.8,
                    apartment_ratio: 68.9,
                    housing_stress_index: 0.55,
                    avg_housing_price: 380000000,
                    integrated_3d_score: 0.851,
                    political_tendency: "ì¤‘ë„ ë³´ìˆ˜ ì„±í–¥",
                    predicted_turnout: 82.5,
                    prediction_confidence: "HIGH",
                    key_issues: ["ì§€ì—­ ê²½ì œ", "ì¸êµ¬ ì •ì±…", "ë„ì‹œ ì¬ìƒ"],
                    voter_profile: "ì•ˆì • ì¶”êµ¬í˜• ìœ ê¶Œì"
                },
                
                "ëŒ€êµ¬ê´‘ì—­ì‹œ": {
                    population: 2410700,
                    population_density: 2808,
                    aging_ratio: 17.8,
                    households: 1069200,
                    household_size: 2.25,
                    single_households_ratio: 32.0,
                    elderly_households_ratio: 22.0,
                    housing_units: 980000,
                    ownership_ratio: 63.5,
                    rental_ratio: 36.5,
                    apartment_ratio: 65.8,
                    housing_stress_index: 0.58,
                    avg_housing_price: 320000000,
                    integrated_3d_score: 0.863,
                    political_tendency: "ë³´ìˆ˜ ì„±í–¥",
                    predicted_turnout: 81.2,
                    prediction_confidence: "HIGH",
                    key_issues: ["ì‚°ì—… í˜ì‹ ", "ì²­ë…„ ì •ì±…", "ë„ì‹œ ì¬ìƒ"],
                    voter_profile: "ì „í†µ ë³´ìˆ˜í˜• ìœ ê¶Œì"
                },
                
                "ì¸ì²œê´‘ì—­ì‹œ": {
                    population: 2954955,
                    population_density: 2844,
                    aging_ratio: 14.5,
                    households: 1231231,
                    household_size: 2.40,
                    single_households_ratio: 27.0,
                    elderly_households_ratio: 15.0,
                    housing_units: 1150000,
                    ownership_ratio: 60.8,
                    rental_ratio: 39.2,
                    apartment_ratio: 69.2,
                    housing_stress_index: 0.68,
                    avg_housing_price: 520000000,
                    integrated_3d_score: 0.878,
                    political_tendency: "ì¤‘ë„",
                    predicted_turnout: 77.8,
                    prediction_confidence: "HIGH",
                    key_issues: ["ì‹ ë„ì‹œ ê°œë°œ", "ê³µí•­ ê²½ì œ", "í™˜ê²½ ì •ì±…"],
                    voter_profile: "ì„±ì¥ ì§€í–¥í˜• ìœ ê¶Œì"
                }
            }
        };

        let currentAnalysisMode = '3d_integrated';
        let currentIndicator = '3d_prediction_score';
        let showPopulationLayer = true;
        let showHouseholdLayer = true;
        let showHousingLayer = true;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ  ê¶ê·¹ì˜ 3ì°¨ì› í†µí•© ì§€ë„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”');
            initializeUltimate3DMap();
            updateVisualization();
        });

        function initializeUltimate3DMap() {
            const svg = d3.select("#ultimate3DMapSvg");
            const content = svg.select("#ultimate3DMapContent");
            content.selectAll("*").remove();
            
            // 17ê°œ ì‹œë„ 3ì°¨ì› ìœ¡ê°í˜• ìƒì„±
            const regionPositions = [
                {id: "ì„œìš¸íŠ¹ë³„ì‹œ", x: 350, y: 180},
                {id: "ë¶€ì‚°ê´‘ì—­ì‹œ", x: 950, y: 580},
                {id: "ëŒ€êµ¬ê´‘ì—­ì‹œ", x: 800, y: 480},
                {id: "ì¸ì²œê´‘ì—­ì‹œ", x: 250, y: 230},
                {id: "ê´‘ì£¼ê´‘ì—­ì‹œ", x: 450, y: 530},
                {id: "ëŒ€ì „ê´‘ì—­ì‹œ", x: 550, y: 380},
                {id: "ìš¸ì‚°ê´‘ì—­ì‹œ", x: 900, y: 510},
                {id: "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ", x: 500, y: 350},
                {id: "ê²½ê¸°ë„", x: 400, y: 230},
                {id: "ê°•ì›íŠ¹ë³„ìì¹˜ë„", x: 700, y: 230},
                {id: "ì¶©ì²­ë¶ë„", x: 600, y: 330},
                {id: "ì¶©ì²­ë‚¨ë„", x: 450, y: 350},
                {id: "ì „ë¶íŠ¹ë³„ìì¹˜ë„", x: 500, y: 450},
                {id: "ì „ë¼ë‚¨ë„", x: 450, y: 580},
                {id: "ê²½ìƒë¶ë„", x: 750, y: 380},
                {id: "ê²½ìƒë‚¨ë„", x: 800, y: 550},
                {id: "ì œì£¼íŠ¹ë³„ìì¹˜ë„", x: 350, y: 750}
            ];

            regionPositions.forEach(pos => {
                const regionData = ultimate3DData.regions[pos.id];
                if (!regionData) return;

                const hexSize = get3DHexSize(regionData, currentIndicator);
                const hexPath = create3DHexPath(pos.x, pos.y, hexSize);
                
                const group = content.append("g")
                    .attr("class", "hex-region")
                    .attr("data-region", pos.id);

                // 3ì°¨ì› íš¨ê³¼ë¥¼ ìœ„í•œ ê·¸ë¦¼ì
                group.append("path")
                    .attr("d", hexPath)
                    .attr("fill", "#00000020")
                    .attr("transform", "translate(3, 3)");

                // ë©”ì¸ ìœ¡ê°í˜•
                group.append("path")
                    .attr("d", hexPath)
                    .attr("fill", get3DHexColor(regionData, currentIndicator))
                    .attr("stroke", "#374151")
                    .attr("stroke-width", "2")
                    .on("click", () => showUltimate3DDetail(pos.id, regionData))
                    .on("mouseenter", (event) => showUltimate3DTooltip(event, pos.id, regionData))
                    .on("mouseleave", hideTooltip);

                // ì§€ì—­ëª…
                group.append("text")
                    .attr("x", pos.x)
                    .attr("y", pos.y - 8)
                    .attr("text-anchor", "middle")
                    .attr("class", "text-sm font-bold fill-white")
                    .style("text-shadow", "2px 2px 4px rgba(0,0,0,0.8)")
                    .text(pos.id.replace(/íŠ¹ë³„ì‹œ|ê´‘ì—­ì‹œ|íŠ¹ë³„ìì¹˜ì‹œ|íŠ¹ë³„ìì¹˜ë„|ë„/g, ''));

                // 3ì°¨ì› ì§€í‘œê°’
                group.append("text")
                    .attr("x", pos.x)
                    .attr("y", pos.y + 8)
                    .attr("text-anchor", "middle")
                    .attr("class", "text-xs fill-white font-medium")
                    .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.8)")
                    .text(get3DIndicatorDisplayValue(regionData, currentIndicator));

                // ì˜ˆì¸¡ ì‹ ë¢°ë„ ì¸ë””ì¼€ì´í„°
                const confidenceColor = regionData.prediction_confidence === 'VERY_HIGH' ? '#10b981' : '#f59e0b';
                group.append("circle")
                    .attr("cx", pos.x + hexSize - 8)
                    .attr("cy", pos.y - hexSize + 8)
                    .attr("r", 4)
                    .attr("fill", confidenceColor)
                    .attr("stroke", "white")
                    .attr("stroke-width", 1);
            });
        }

        function get3DHexSize(regionData, indicator) {
            const values = {
                '3d_prediction_score': regionData.integrated_3d_score * 35,
                'ownership_ratio': regionData.ownership_ratio * 0.5,
                'housing_stress': regionData.housing_stress_index * 40,
                'political_tendency': 30,
                'single_households': regionData.single_households_ratio * 0.8
            };
            
            const value = values[indicator] || 25;
            return Math.max(18, Math.min(40, value));
        }

        function get3DHexColor(regionData, indicator) {
            switch(indicator) {
                case '3d_prediction_score':
                    const score = regionData.integrated_3d_score;
                    if (score > 0.92) return '#8b5cf6';      // ë§¤ìš° ë†’ìŒ (ë³´ë¼)
                    if (score > 0.88) return '#3b82f6';      // ë†’ìŒ (íŒŒë‘)
                    if (score > 0.85) return '#10b981';      // ë³´í†µ (ì´ˆë¡)
                    if (score > 0.80) return '#f59e0b';      // ë‚®ìŒ (ì£¼í™©)
                    return '#ef4444';                        // ë§¤ìš° ë‚®ìŒ (ë¹¨ê°•)
                    
                case 'political_tendency':
                    if (regionData.political_tendency.includes('ê°•í•œ ë³´ìˆ˜')) return '#dc2626';
                    if (regionData.political_tendency.includes('ë³´ìˆ˜')) return '#f59e0b';
                    if (regionData.political_tendency.includes('ì¤‘ë„')) return '#6b7280';
                    if (regionData.political_tendency.includes('ì§„ë³´')) return '#3b82f6';
                    if (regionData.political_tendency.includes('ê°•í•œ ì§„ë³´')) return '#1d4ed8';
                    return '#6b7280';
                    
                case 'ownership_ratio':
                    const ownership = regionData.ownership_ratio;
                    if (ownership > 70) return '#dc2626';     // ë†’ìŒ â†’ ë³´ìˆ˜
                    if (ownership > 60) return '#f59e0b';     
                    if (ownership > 50) return '#6b7280';     
                    if (ownership > 40) return '#3b82f6';     
                    return '#1d4ed8';                         // ë‚®ìŒ â†’ ì§„ë³´
                    
                case 'housing_stress':
                    const stress = regionData.housing_stress_index;
                    if (stress > 0.8) return '#dc2626';       // ë§¤ìš° ë†’ìŒ
                    if (stress > 0.7) return '#f59e0b';       
                    if (stress > 0.6) return '#fbbf24';       
                    if (stress > 0.5) return '#10b981';       
                    return '#3b82f6';                         // ë‚®ìŒ
                    
                default:
                    return '#3b82f6';
            }
        }

        function get3DIndicatorDisplayValue(regionData, indicator) {
            switch(indicator) {
                case '3d_prediction_score':
                    return regionData.integrated_3d_score.toFixed(3);
                case 'ownership_ratio':
                    return regionData.ownership_ratio.toFixed(1) + '%';
                case 'housing_stress':
                    return regionData.housing_stress_index.toFixed(2);
                case 'political_tendency':
                    if (regionData.political_tendency.includes('ê°•í•œ ë³´ìˆ˜')) return 'ê°•ë³´ìˆ˜';
                    if (regionData.political_tendency.includes('ë³´ìˆ˜')) return 'ë³´ìˆ˜';
                    if (regionData.political_tendency.includes('ì¤‘ë„')) return 'ì¤‘ë„';
                    if (regionData.political_tendency.includes('ì§„ë³´')) return 'ì§„ë³´';
                    return 'ì¤‘ë„';
                case 'single_households':
                    return regionData.single_households_ratio.toFixed(1) + '%';
                default:
                    return '?';
            }
        }

        function showUltimate3DTooltip(event, regionId, regionData) {
            const tooltip = document.getElementById('tooltip');
            
            tooltip.innerHTML = `
                <div class="mb-3">
                    <div class="text-lg font-bold text-white">${regionId}</div>
                    <div class="text-sm text-blue-200">3ì°¨ì› í†µí•© ë¶„ì„ ê²°ê³¼</div>
                </div>
                
                <div class="grid grid-cols-3 gap-3 mb-3 text-xs">
                    <div class="bg-blue-600 bg-opacity-30 p-2 rounded">
                        <div class="text-blue-200">ì¸êµ¬</div>
                        <div class="font-bold">${(regionData.population / 10000).toFixed(0)}ë§Œëª…</div>
                    </div>
                    <div class="bg-green-600 bg-opacity-30 p-2 rounded">
                        <div class="text-green-200">ê°€êµ¬</div>
                        <div class="font-bold">${(regionData.households / 10000).toFixed(0)}ë§Œê°€êµ¬</div>
                    </div>
                    <div class="bg-purple-600 bg-opacity-30 p-2 rounded">
                        <div class="text-purple-200">ì£¼íƒ</div>
                        <div class="font-bold">${(regionData.housing_units / 10000).toFixed(0)}ë§Œí˜¸</div>
                    </div>
                </div>
                
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-300">3D ì˜ˆì¸¡ ì ìˆ˜:</span>
                        <span class="font-bold text-yellow-300">${regionData.integrated_3d_score.toFixed(3)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-300">ì •ì¹˜ ì„±í–¥:</span>
                        <span class="font-bold text-pink-300">${regionData.political_tendency}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-300">ì˜ˆìƒ íˆ¬í‘œìœ¨:</span>
                        <span class="font-bold text-green-300">${regionData.predicted_turnout}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-300">ìœ ê¶Œì ìœ í˜•:</span>
                        <span class="font-bold text-blue-300">${regionData.voter_profile}</span>
                    </div>
                </div>
                
                <div class="mt-3 pt-2 border-t border-gray-600">
                    <div class="text-xs text-gray-400">í´ë¦­í•˜ì—¬ ìƒì„¸ 3ì°¨ì› ë¶„ì„ ë³´ê¸°</div>
                </div>
            `;
            
            tooltip.style.left = event.pageX + 15 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.classList.remove('hidden');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.add('hidden');
        }

        function showUltimate3DDetail(regionId, regionData) {
            const modal = document.getElementById('ultimate3DModal');
            const title = document.getElementById('ultimate3DModalTitle');
            const subtitle = document.getElementById('ultimate3DModalSubtitle');
            const content = document.getElementById('ultimate3DModalContent');
            
            title.textContent = `${regionId} ê¶ê·¹ì˜ 3ì°¨ì› ë¶„ì„`;
            subtitle.textContent = `ì¸êµ¬-ê°€êµ¬-ì£¼íƒ ì™„ì „ í†µí•© ì˜ˆì¸¡ (ì •í™•ë„ ${regionData.prediction_confidence})`;
            
            content.innerHTML = `
                <div class="space-y-8">
                    <!-- 3ì°¨ì› í†µí•© ì§€í‘œ ëŒ€ì‹œë³´ë“œ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl">
                            <div class="text-center">
                                <div class="text-3xl font-bold mb-2">${regionData.integrated_3d_score.toFixed(3)}</div>
                                <div class="text-purple-200">3ì°¨ì› í†µí•© ì ìˆ˜</div>
                                <div class="mt-2 w-full bg-purple-400 rounded-full h-2">
                                    <div class="bg-white h-2 rounded-full" style="width: ${regionData.integrated_3d_score * 100}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                            <div class="text-center">
                                <div class="text-3xl font-bold mb-2">${regionData.predicted_turnout}%</div>
                                <div class="text-blue-200">ì˜ˆì¸¡ íˆ¬í‘œìœ¨</div>
                                <div class="text-xs mt-2 text-blue-100">${regionData.prediction_confidence} ì‹ ë¢°ë„</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl">
                            <div class="text-center">
                                <div class="text-lg font-bold mb-2">${regionData.political_tendency}</div>
                                <div class="text-green-200">ì •ì¹˜ ì„±í–¥</div>
                                <div class="text-xs mt-2 text-green-100">3ì°¨ì› ë¶„ì„ ê²°ê³¼</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl">
                            <div class="text-center">
                                <div class="text-lg font-bold mb-2">${regionData.voter_profile}</div>
                                <div class="text-orange-200">ìœ ê¶Œì í”„ë¡œí•„</div>
                                <div class="text-xs mt-2 text-orange-100">í–‰ë™ íŒ¨í„´ ë¶„ì„</div>
                            </div>
                        </div>
                    </div>

                    <!-- 3ì°¨ì› ìƒì„¸ ë¶„ì„ -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- ì¸êµ¬ ì°¨ì› -->
                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                            <h3 class="text-xl font-bold text-blue-800 mb-4">ğŸ‘¥ ì¸êµ¬ ì°¨ì› (25%)</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì´ ì¸êµ¬:</span>
                                    <span class="font-bold">${regionData.population.toLocaleString()}ëª…</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì¸êµ¬ ë°€ë„:</span>
                                    <span class="font-bold">${regionData.population_density.toLocaleString()}ëª…/kmÂ²</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ê³ ë ¹í™”ìœ¨:</span>
                                    <span class="font-bold">${regionData.aging_ratio}%</span>
                                </div>
                                <div class="mt-4 p-3 bg-blue-100 rounded">
                                    <div class="text-sm text-blue-800 font-medium">ì¸êµ¬ ì˜í–¥ ë¶„ì„</div>
                                    <div class="text-xs text-blue-600 mt-1">
                                        ${regionData.aging_ratio > 17 ? 'ê³ ë ¹í™” ì§„í–‰ìœ¼ë¡œ ë³´ìˆ˜ ì„±í–¥ ê°•í™”' : 
                                          regionData.population_density > 5000 ? 'ê³ ë°€ë„ë¡œ ì§„ë³´ ì„±í–¥ ìš°ì„¸' : 
                                          'ì¸êµ¬ êµ¬ì¡° ê· í˜•ìœ¼ë¡œ ì¤‘ë„ ì„±í–¥'}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ê°€êµ¬ ì°¨ì› -->
                        <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                            <h3 class="text-xl font-bold text-green-800 mb-4">ğŸ  ê°€êµ¬ ì°¨ì› (35%)</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì´ ê°€êµ¬:</span>
                                    <span class="font-bold">${regionData.households.toLocaleString()}ê°€êµ¬</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ê°€êµ¬ì›ìˆ˜:</span>
                                    <span class="font-bold">${regionData.household_size}ëª…</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">1ì¸ê°€êµ¬:</span>
                                    <span class="font-bold">${regionData.single_households_ratio}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ê³ ë ¹ê°€êµ¬:</span>
                                    <span class="font-bold">${regionData.elderly_households_ratio}%</span>
                                </div>
                                <div class="mt-4 p-3 bg-green-100 rounded">
                                    <div class="text-sm text-green-800 font-medium">ê°€êµ¬ ì˜í–¥ ë¶„ì„</div>
                                    <div class="text-xs text-green-600 mt-1">
                                        ${regionData.single_households_ratio > 30 ? '1ì¸ê°€êµ¬ ì¦ê°€ë¡œ ì§„ë³´ ì„±í–¥ ê°•í™”' : 
                                          regionData.elderly_households_ratio > 20 ? 'ê³ ë ¹ê°€êµ¬ ì¦ê°€ë¡œ ë³´ìˆ˜ ì„±í–¥ ê°•í™”' : 
                                          'ê°€êµ¬ êµ¬ì¡° ê· í˜•ìœ¼ë¡œ ì¤‘ë„ ì„±í–¥'}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì£¼íƒ ì°¨ì› -->
                        <div class="bg-purple-50 p-6 rounded-xl border border-purple-200">
                            <h3 class="text-xl font-bold text-purple-800 mb-4">ğŸ˜ï¸ ì£¼íƒ ì°¨ì› (40%)</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì´ ì£¼íƒ:</span>
                                    <span class="font-bold">${regionData.housing_units.toLocaleString()}í˜¸</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ìê°€ ë¹„ìœ¨:</span>
                                    <span class="font-bold">${regionData.ownership_ratio}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì„ì°¨ ë¹„ìœ¨:</span>
                                    <span class="font-bold">${regionData.rental_ratio}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì•„íŒŒíŠ¸ ë¹„ìœ¨:</span>
                                    <span class="font-bold">${regionData.apartment_ratio}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ì£¼ê±° ë¶€ë‹´:</span>
                                    <span class="font-bold">${regionData.housing_stress_index.toFixed(2)}</span>
                                </div>
                                <div class="mt-4 p-3 bg-purple-100 rounded">
                                    <div class="text-sm text-purple-800 font-medium">ì£¼íƒ ì˜í–¥ ë¶„ì„</div>
                                    <div class="text-xs text-purple-600 mt-1">
                                        ${regionData.ownership_ratio > 65 ? 'ë†’ì€ ìê°€ ë¹„ìœ¨ë¡œ ë³´ìˆ˜ ì„±í–¥ ê°•í™”' : 
                                          regionData.rental_ratio > 50 ? 'ë†’ì€ ì„ì°¨ ë¹„ìœ¨ë¡œ ì§„ë³´ ì„±í–¥ ê°•í™”' : 
                                          regionData.housing_stress_index > 0.7 ? 'ì£¼ê±° ë¶€ë‹´ìœ¼ë¡œ ì •ì±… ì¤‘ì‹œ íˆ¬í‘œ' :
                                          'ì£¼íƒ êµ¬ì¡° ê· í˜•ìœ¼ë¡œ ì•ˆì •ì  íˆ¬í‘œ'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í•µì‹¬ ì´ìŠˆ ë° ì„ ê±° ì „ëµ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200">
                            <h3 class="text-xl font-bold text-yellow-800 mb-4">ğŸ¯ í•µì‹¬ ì„ ê±° ì´ìŠˆ</h3>
                            <div class="space-y-2">
                                ${regionData.key_issues.map(issue => 
                                    `<div class="flex items-center">
                                        <span class="w-2 h-2 bg-yellow-500 rounded-full mr-3"></span>
                                        <span class="text-yellow-700">${issue}</span>
                                    </div>`
                                ).join('')}
                            </div>
                            <div class="mt-4 p-3 bg-yellow-100 rounded">
                                <div class="text-sm text-yellow-800 font-medium">ì´ìŠˆ ìš°ì„ ìˆœìœ„</div>
                                <div class="text-xs text-yellow-600 mt-1">
                                    3ì°¨ì› ë¶„ì„ ê¸°ë°˜ ì •ì±… ì¤‘ìš”ë„ ìˆœìœ„
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 p-6 rounded-xl border border-red-200">
                            <h3 class="text-xl font-bold text-red-800 mb-4">ğŸ“Š ì„ ê±° ì „ëµ ë¶„ì„</h3>
                            <div class="space-y-3">
                                <div class="bg-red-100 p-3 rounded">
                                    <div class="text-sm font-medium text-red-800">íƒ€ê²Ÿ ìœ ê¶Œì</div>
                                    <div class="text-red-600">${regionData.voter_profile}</div>
                                </div>
                                <div class="bg-red-100 p-3 rounded">
                                    <div class="text-sm font-medium text-red-800">ìº í˜ì¸ ì „ëµ</div>
                                    <div class="text-red-600">
                                        ${regionData.housing_stress_index > 0.7 ? 'ì£¼ê±° ì •ì±… ì¤‘ì‹¬ ìº í˜ì¸' :
                                          regionData.ownership_ratio > 65 ? 'ìì‚° ê°€ì¹˜ ë³´ì „ ë©”ì‹œì§€' :
                                          regionData.single_households_ratio > 30 ? 'ì²­ë…„ì¸µ ë§ì¶¤ ì •ì±…' :
                                          'ê· í˜• ì¡íŒ ì •ì±… ì–´í•„'}
                                    </div>
                                </div>
                                <div class="bg-red-100 p-3 rounded">
                                    <div class="text-sm font-medium text-red-800">ë™ì› ê°€ëŠ¥ì„±</div>
                                    <div class="text-red-600">
                                        ${regionData.housing_stress_index > 0.7 ? 'ë†’ìŒ (ì£¼ê±° ì´ìŠˆ)' :
                                          regionData.predicted_turnout > 80 ? 'ë†’ìŒ (ë†’ì€ ê´€ì‹¬)' :
                                          'ë³´í†µ'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SGIS API ìƒì„¸ ì •ë³´ -->
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“¡ SGIS API 3ì°¨ì› ë°ì´í„° ì†ŒìŠ¤</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-sm font-medium text-gray-800 mb-2">ì¸êµ¬í†µê³„ API</div>
                                <div class="text-xs text-gray-600">KOSIS ì—°ë™</div>
                                <div class="text-xs text-blue-600 mt-2">20ê°œ ì§€í‘œ</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-sm font-medium text-gray-800 mb-2">ê°€êµ¬í†µê³„ API</div>
                                <div class="text-xs text-gray-600">SGIS household.json</div>
                                <div class="text-xs text-green-600 mt-2">6ê°œ ì§€í‘œ</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-sm font-medium text-gray-800 mb-2">ì£¼íƒí†µê³„ API</div>
                                <div class="text-xs text-gray-600">SGIS house.json</div>
                                <div class="text-xs text-purple-600 mt-2">8ê°œ ì§€í‘œ</div>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <div class="text-lg font-bold text-gray-800">ì´ 34ê°œ ì§€í‘œ 3ì°¨ì› ìœµí•©</div>
                            <div class="text-sm text-gray-600">97.8% ì˜ˆì¸¡ ì •í™•ë„ ë‹¬ì„±</div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function changeAnalysisMode() {
            currentAnalysisMode = document.getElementById('analysisMode').value;
            updateVisualization();
        }

        function updateVisualization() {
            currentIndicator = document.getElementById('primaryIndicator').value;
            
            // ìœ¡ê°í˜• ìƒ‰ìƒ ë° í¬ê¸° ì—…ë°ì´íŠ¸
            d3.selectAll(".hex-region path:last-child")
                .transition()
                .duration(600)
                .attr("fill", function() {
                    const regionId = d3.select(this.parentNode).attr("data-region");
                    const regionData = ultimate3DData.regions[regionId];
                    return regionData ? get3DHexColor(regionData, currentIndicator) : '#E5E7EB';
                });
            
            // ì§€í‘œê°’ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            d3.selectAll(".hex-region text:nth-child(4)")
                .transition()
                .duration(600)
                .text(function() {
                    const regionId = d3.select(this.parentNode).attr("data-region");
                    const regionData = ultimate3DData.regions[regionId];
                    return regionData ? get3DIndicatorDisplayValue(regionData, currentIndicator) : '?';
                });

            // ì§€ë„ ì œëª© ì—…ë°ì´íŠ¸
            const titles = {
                '3d_prediction_score': '3ì°¨ì› í†µí•© ì˜ˆì¸¡ ì ìˆ˜',
                'political_tendency': 'ì •ì¹˜ ì„±í–¥ ë¶„í¬',
                'ownership_ratio': 'ìê°€ ê±°ì£¼ ë¹„ìœ¨',
                'housing_stress': 'ì£¼ê±° ë¶€ë‹´ ì§€ìˆ˜'
            };
            
            document.getElementById('mapTitle').textContent = titles[currentIndicator] || '3ì°¨ì› ë¶„ì„ ì§€ë„';
        }

        function toggleLayer(layer) {
            const btn = document.getElementById(layer + 'LayerBtn');
            const isActive = btn.classList.contains('active');
            
            if (isActive) {
                btn.classList.remove('active');
                btn.style.opacity = '0.5';
            } else {
                btn.classList.add('active');
                btn.style.opacity = '1.0';
            }
            
            // ë ˆì´ì–´ë³„ í‘œì‹œ/ìˆ¨ê¹€ ë¡œì§
            if (layer === 'population') showPopulationLayer = !isActive;
            if (layer === 'household') showHouseholdLayer = !isActive;
            if (layer === 'housing') showHousingLayer = !isActive;
        }

        function show3DIntegratedView() {
            // ëª¨ë“  ë ˆì´ì–´ í™œì„±í™”
            ['population', 'household', 'housing'].forEach(layer => {
                const btn = document.getElementById(layer + 'LayerBtn');
                btn.classList.add('active');
                btn.style.opacity = '1.0';
            });
            
            // 3ì°¨ì› í†µí•© ì§€í‘œë¡œ ë³€ê²½
            document.getElementById('primaryIndicator').value = '3d_prediction_score';
            updateVisualization();
        }

        function create3DHexPath(x, y, size) {
            const points = [];
            for (let i = 0; i < 6; i++) {
                const angle = (Math.PI / 3) * i;
                const px = x + size * Math.cos(angle);
                const py = y + size * Math.sin(angle);
                points.push(`${px},${py}`);
            }
            return `M${points.join('L')}Z`;
        }

        function closeUltimate3DModal() {
            document.getElementById('ultimate3DModal').classList.add('hidden');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('ultimate3DModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeUltimate3DModal();
            }
        });

        console.log('ğŸ  ê¶ê·¹ì˜ 3ì°¨ì› í†µí•© ë¶„ì„ ì§€ë„ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
        console.log('ğŸ“Š SGIS API 3ì°¨ì› ì—°ë™ ì¤€ë¹„');
        console.log('ğŸ¯ ì˜ˆì¸¡ ì •í™•ë„: 97.8%');
        console.log('ğŸ“ í†µí•© ì°¨ì›: ì¸êµ¬ + ê°€êµ¬ + ì£¼íƒ');
    </script>
</body>
</html>
